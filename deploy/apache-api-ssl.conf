<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName api.mitzpe6-8.com

    ProxyPreserveHost On
    ProxyRequests Off

    # Timeout settings for long-running requests (gate operations may take time)
    Timeout 300
    ProxyTimeout 300

    # Proxy Socket.IO WebSocket connections (must come before /api)
    # Socket.IO uses /socket.io/ path for all namespaces
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /socket.io/(.*) ws://localhost:3001/socket.io/$1 [P,L]
    ProxyPass /socket.io http://localhost:3001/socket.io
    ProxyPassReverse /socket.io http://localhost:3001/socket.io

    # Proxy all HTTP requests (including OPTIONS for CORS preflight) to backend
    ProxyPass /api http://localhost:3001/api
    ProxyPassReverse /api http://localhost:3001/api

    SSLCertificateFile /etc/letsencrypt/live/api.mitzpe6-8.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/api.mitzpe6-8.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    ErrorLog ${APACHE_LOG_DIR}/api.mitzpe6-8.com-error.log
    CustomLog ${APACHE_LOG_DIR}/api.mitzpe6-8.com-access.log combined
</VirtualHost>
</IfModule>

